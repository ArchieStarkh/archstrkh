<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Donation Goal - Win95</title>
<style>
body {
  background: transparent;
  font-family: "MS Sans Serif", sans-serif;
  color: black;
  margin: 0;
  padding: 0;
}
.win95-window {
  width: 300px;
  border: 2px solid #000;
  background: #c0c0c0;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #808080;
}
.win95-titlebar {
  background: #000080;
  color: white;
  padding: 4px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  font-size: 12px;
}
.win95-titlebar span {
  font-family: monospace;
  letter-spacing: 1px;
}
.win95-content {
  padding: 8px;
  font-size: 12px;
}
.bar {
  height: 20px;
  background: #808080;
  border: 2px solid #000;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #404040;
  margin-top: 6px;
  overflow: hidden;
}
.progress {
  height: 100%;
  background: linear-gradient(90deg, #0000ff, #0044ff);
  box-shadow: inset 1px 1px #8080ff, inset -1px -1px #000066;
  width: 0%;
  transition: width 0.6s ease-in-out;
}
#goal {
  display: none;
}
.button {
  margin-top: 10px;
  background: #c0c0c0;
  border: 2px solid #000;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #808080;
  padding: 3px 6px;
  cursor: pointer;
  font-family: "MS Sans Serif";
}
.button:active {
  box-shadow: inset 1px 1px #000, inset -1px -1px #fff;
}
</style>
</head>
<body>
  <div class="win95-window" id="goal">
    <div class="win95-titlebar">
      <div>üè† –ù–∞ —Ö–∞—Ç—É</div><span>_ ‚ñ° X</span>
    </div>
    <div class="win95-content">
      <div>–°–æ–±—Ä–∞–Ω–æ: <span id="current">0</span> / <span id="goalTotal">10000</span> ‚ÇΩ</div>
      <div class="bar"><div class="progress" id="progress"></div></div>
    </div>
  </div>

  <div class="win95-window" id="login" style="text-align:center; padding:10px;">
    <div class="win95-titlebar"><div>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div></div>
    <div class="win95-content">
      <button class="button" onclick="authorize()">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ DonationAlerts</button>
    </div>
  </div>

  <audio id="ding" src="https://cdn.jsdelivr.net/gh/jxmk/Win95Sounds@main/Windows%2095%20Ding.wav" preload="auto"></audio>

<script>
const CLIENT_ID = "16526"; // —Ç–≤–æ–π client_id
const GOAL = 10000;
let current = 0;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –≤ URL
const hash = window.location.hash;
let accessToken = null;
if (hash.includes("access_token=")) {
  accessToken = new URLSearchParams(hash.substring(1)).get("access_token");
  window.history.replaceState({}, document.title, window.location.pathname);
}

if (accessToken) {
  document.getElementById("login").style.display = "none";
  document.getElementById("goal").style.display = "block";
  connectWebSocket();
}

function authorize() {
  const redirect = encodeURIComponent(window.location.href);
  window.location.href = `https://www.donationalerts.com/oauth/authorize?client_id=${CLIENT_ID}&redirect_uri=${redirect}&response_type=token&scope=oauth-donation-index`;
}

function connectWebSocket() {
  const ws = new WebSocket("wss://socket.donationalerts.ru:443");
  ws.onopen = () => {
    ws.send(JSON.stringify({
      command: "subscribe",
      params: { access_token: accessToken }
    }));
  };
  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.event === "donation") {
      const payload = data.payload;
      const amount = parseFloat(payload.amount);
      current += amount;
      updateBar();
      document.getElementById("ding").play();
    }
  };
}

function updateBar() {
  const percent = Math.min(100, (current / GOAL) * 100);
  document.getElementById("current").textContent = current.toFixed(2);
  document.getElementById("progress").style.width = percent + "%";
}
</script>
</body>
</html>
