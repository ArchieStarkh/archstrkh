<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–î–æ–Ω–∞—Ç–≥–æ–ª ‚Äî –ù–∞ —Ö–∞—Ç—É</title>
<style>
body {
  background: transparent;
  font-family: "MS Sans Serif", sans-serif;
  color: black;
  margin: 0;
  padding: 0;
}
.win95-window {
  width: 300px;
  border: 2px solid #000;
  background: #c0c0c0;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #808080;
}
.win95-titlebar {
  background: #000080;
  color: white;
  padding: 3px 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  font-size: 12px;
  height: 20px;
  line-height: 14px;
  user-select: none;
}
.win95-titlebar .buttons {
  display: flex;
  gap: 4px;
}
.win95-button {
  width: 16px;
  height: 14px;
  background: #c0c0c0;
  border: 1px solid #000;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #808080;
  text-align: center;
  line-height: 12px;
  font-size: 10px;
}
.win95-button:active {
  box-shadow: inset 1px 1px #000, inset -1px -1px #fff;
}
.win95-button:hover {
  background: #d8d8d8;
}
.win95-content {
  padding: 8px;
  font-size: 12px;
}
.bar {
  height: 20px;
  background: #808080;
  border: 2px solid #000;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #404040;
  margin-top: 6px;
  overflow: hidden;
}
.progress {
  height: 100%;
  background: linear-gradient(90deg, #0000ff, #0044ff);
  box-shadow: inset 1px 1px #8080ff, inset -1px -1px #000066;
  width: 0%;
  transition: width 0.6s ease-in-out;
}
#goal {
  display: none;
}
.button {
  margin-top: 10px;
  background: #c0c0c0;
  border: 2px solid #000;
  box-shadow: inset -1px -1px #fff, inset 1px 1px #808080;
  padding: 3px 6px;
  cursor: pointer;
  font-family: "MS Sans Serif";
}
.button:active {
  box-shadow: inset 1px 1px #000, inset -1px -1px #fff;
}
</style>
</head>
<body>
<div class="win95-window">
  <div class="win95-titlebar">
    <div>üè† –ù–∞ —Ö–∞—Ç—É</div>
    <div class="buttons">
      <div class="win95-button">_</div>
      <div class="win95-button">‚ñ°</div>
      <div class="win95-button">X</div>
    </div>
  </div>
  <div class="win95-content">
    <div>–°–æ–±—Ä–∞–Ω–æ: <span id="amount">0</span> / 10000 ‚ÇΩ</div>
    <div class="bar"><div class="progress" id="progress"></div></div>
    <button class="button" id="connect">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å DonationAlerts</button>
  </div>
</div>

<script>
const CLIENT_ID = "16526"; // –¢–≤–æ–π ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const REDIRECT_URI = "https://archiestarkh.github.io/archstrkh/";
const SCOPE = "oauth-user-show+donation-subscribe";

const authBtn = document.getElementById("connect");
authBtn.addEventListener("click", () => {
  const authUrl = `https://www.donationalerts.com/oauth/authorize?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=token&scope=${SCOPE}`;
  window.location.href = authUrl;
});

function getTokenFromHash() {
  const hash = window.location.hash.substr(1);
  const params = new URLSearchParams(hash);
  return params.get("access_token");
}

async function getDonations(token) {
  const res = await fetch("https://www.donationalerts.com/api/v1/alerts/donations", {
    headers: { Authorization: "Bearer " + token }
  });
  const data = await res.json();
  let sum = 0;
  data.data.forEach(d => sum += parseFloat(d.amount_main));
  return sum;
}

async function updateGoal() {
  const token = getTokenFromHash();
  if (!token) return;
  authBtn.style.display = "none";
  const total = await getDonations(token);
  document.getElementById("amount").innerText = total.toFixed(0);
  const percent = Math.min((total / 10000) * 100, 100);
  document.getElementById("progress").style.width = percent + "%";
}

updateGoal();
</script>
</body>
</html>

